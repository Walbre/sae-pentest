
### c Apache2

Le service Apache 2 a pour objectif d'héberger le site web. Dans notre cas, il tourne sur son port par défaut (tcp 80). Le site web hébergé est un wordpress basique contenu dans le repertoire `/secret/`. Le contenu hébergé est celui par défaut après l'installation.

#### 1. Execution de code arbitraire dans wordpress

![web1](images/cartouche_web_1.png)

CVSS 3.1 : AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H

L'exécution de code arbitraire est possible en injectant un module vulnérable dans le wordpress. Cette vulnérabilité est utilisable par un attaquant à la seule condition qu'il réussise à se connecter en tant qu'administretur (ou equivalent) sur le site web.


Pour empecher l'utilisation de cette vulnérabilitée, il faut modifier le mot de passe de l'utilisateur administrateur afin de le rendre plus complexe<sub>(1)</sub>. De plus, il est consillé de modifier le nom de cet utilisateur (par défaut admin). L'exécution de ce service dans un conteneur et la mise en place d'une DMZ sont aussi des mesures recommandés afin de limiter les degâts en cas de compromisson.

<sub>(1)</sub> Majuscule/minuscule/chiffre/caractères spéciaux d'une taille d'au moins 12 caractères difficiles à deviner


Pour reproduire la faille, il est nécessaire de se connecter en tant qu'administrateur au wordpress puis d'installer le module [reflex gallery en version 3.1.3](https://www.exploit-db.com/apps/ad33afbc2f2e22877b202d986acd43bd-reflex-gallery.zip). Une fois le module installé, il est possible d'utiliser une vulnérabilité dans ce dernier afin d'envoyer des fichiers php sur le serveur. En envoyant du code malveillant, il est donc possible de compromettre la machine. Un script d'exploitation permettant d'exécuter des commandes est contenu dans le fichier `scripts/exploit-web1.py`.


#### 2. XSS (Cross Site Scripting) dans wordpress

![web2](images/cartouche_web_2.png)

CVSS 3.1 : AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H

La XSS (Stockée) est possible en injectant du javascript sur les pages du site (avec les modules wordpress). Cette vulnérabillité permet à un attaquant de récuperer des informations et de rediriger sur d'autres sites les clients visitant le site web. Il faut néanmoins que l'attaquant ait les privilèges d'administrateur afin de la mettre en place.

Afin d'empecher l'utilisation de cette vulnérabilitée, il faut sécuriser le mot de passe administrateur. Comme pour la vulnérabilitée précédente, il donc est nécessaire de modifier ce mot de passe car il est actuelement trop faible. Il est aussi conseillé de modifier le nom d'utilisateur de `admin`. La mise en place d'une CSP (Content Security Policy) est une bonne pratique si jamais le contenu du site devenait vulnérable à une XSS d'un utilisateur non administrateur.

Afin de reproduire cette faille, il est nécessaire de se connecter en administrateur du site wordpress. Une fois cela fait, il faut installer l'extension `WP Code`. Cette extension va permettre d'exécuter du javascript sur les pages du site. Ensuite, il faut créer un snippet qui a pour cible toutes les pages du site web. Par exemple, si un attaquant veut rediriger tous les utilisateurs vistant le site sur `example.com`, il suffirait d'exécuter \<script\>window.location = "http://example.com"\</script\>


#### 3. Deni de service avec Slowloris

![web3](images/cartouche_web_3.png)

CVSS 3.1 : AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

Le concept de cette vulnerabilitée est d'ouvrir un grand nombre de sessions avec le serveur web. Le script essaye ensiute de les garder le plus longtemps possible ouvertes. Une fois qu'un nombre suffisant de sessions ont été créées pour dépacer la capacité de puissance de calcul du serveur, le site web devient inaccessible. 

Pour regler une partie de cette vulnerabilitée, il est conseillé de mettre à jour le serveur web (apache) à la dernière version disponnible. Cette mesure permettra de mieux gérer l'ouverture de sessions longues. Afin d'empecher que le serveur soit surchargé, il est possible de modifier la configuration d'Apache afin d'accepter un nombre défini de requetes venant d'un seul utilisateur. L'utilisation d'une protection anti DOS comme celle de cloudflare est un moyen plus efficace de ce prévenire de ce type d'attaques.

L'exploitation de cette vunlérabilité passe par l'utilisation d'un outil appelé `pwnloris`. Cette outil disponible [ici](https://github.com/h0ussni/pwnloris), initie un grand nombre de connexions à une cible puis essaye de les garder le plus longtemps possible. Ce DOS dépend de la puissance du serveur qui héberge le site web. Pour améliorer son efficacité, il est possible d'augmenter le nombre de machines exécutant le script en parallèle.
